# Moringa Menu Database Migration Guide

## ğŸ“‹ Overview
This migration will replace your current database with the **corrected menu** that matches your actual restaurant menu exactly.

## âœ… What's Been Fixed

### **Categories** (6 total)
- ×›×¨×™×›×™× (Sandwiches)
- ××¨×•×—×ª ×‘×•×§×¨ (Breakfast)
- ×©×ª×™×” ×—××” (Hot Drinks)
- ××™×¥ ×˜×‘×¢×™ (Fresh Juices)
- ×¢×™×§×¨×™×•×ª (Main Courses)
- ×¡×œ×˜×™× (Salads)

### **Ingredients** (43 total)
**Premium Add-ons (with prices):**
- ××‘×•×§×“×• (Avocado) - â‚ª5
- ×˜×•× ×” (Tuna) - â‚ª5
- ×‘×™×¦×” ×§×©×” (Hard Egg) - â‚ª5
- ×—×–×” ×¢×•×£ ××¤×•×™ (Grilled Chicken) - â‚ª20
- ×©× ×™×¦×œ ××¤×•×™ (Baked Schnitzel) - â‚ª20
- ×¡×œ××•×Ÿ ××¤×•×™ (Baked Salmon) - â‚ª25

**Base Ingredients (free, included in meals):**
- All vegetables: ×—×¡×”, ×¢×’×‘× ×™×•×ª, ××œ×¤×¤×•×Ÿ, ×‘×¦×œ, ×¤×œ×¤×œ×™× ×§×œ×•×™×™×, etc.
- All spreads: ×××¨×— ×¤×¡×˜×•, ×××¨×— ×—×¦×™×œ, ×˜×—×™× ×”
- Grains: ×§×™× ×•××”, ×¤×¨×™×§×”, ××•×¨×–, ×¡×¤×’×˜×™
- And 30+ more ingredients

### **Meals** (40 total)

#### **×›×¨×™×›×™× (Sandwiches) - 8 meals**
1. ×›×¨×™×š ×˜×‘×¢×•× ×™ - â‚ª30
2. ×›×¨×™×š ×˜×•× ×” - â‚ª30
3. ×›×¨×™×š ×—×‘×™×ª×” - â‚ª30
4. ×›×¨×™×š ×‘×™×¦×” ×§×©×” - â‚ª30
5. ×›×¨×™×š ×’×‘×™× ×•×ª - â‚ª30
6. ×›×¨×™×š ××‘×•×§×“×• - â‚ª30
7. ×›×¨×™×š ×¢×•×£ - â‚ª40
8. ×›×¨×™×š ×©× ×™×¦×œ - â‚ª40

#### **××¨×•×—×ª ×‘×•×§×¨ (Breakfast) - 5 meals**
1. ×©×§×©×•×§×” - â‚ª65
2. ×—×‘×™×ª×” ×™×¨×§ - â‚ª45
3. ×˜×•×¡×˜ ×’×‘×™× ×” - â‚ª40
4. ×˜×•×¡×˜ ×¤×¡×˜×¨××” - â‚ª40
5. ×˜×•×¡×˜ ×‘×”×¨×›×‘×” ×¢×¦××™×ª - â‚ª40 âœ¨ **NEW**

#### **×©×ª×™×” ×—××” (Hot Drinks) - 7 meals**
1. ×§×¤×” ×”×¤×•×š - â‚ª10
2. ×§×¤×” ×”×¤×•×š ×¡×•×™×” - â‚ª13
3. ×§×¤×” ×”×¤×•×š ×©×™×‘×•×œ×ª ×©×•×¢×œ - â‚ª13
4. ×”×¤×•×š ×©×§×“×™× - â‚ª13 âœ¨ **NEW**
5. ××¡×¤×¨×¡×• - â‚ª10
6. ×××¨×™×§× ×• - â‚ª10
7. ×ª×” - â‚ª10

#### **××™×¥ ×˜×‘×¢×™ (Fresh Juices) - 7 meals**
1. ××™×¥ ×™×¨×•×§ - â‚ª23
2. ×¡×œ×§ - â‚ª23
3. ×’×–×¨ - â‚ª23
4. ×ª×¤×•×–×™× - â‚ª23
5. ×¡×œ×§ ×•×’×–×¨ - â‚ª23
6. ×’×–×¨ ×•×ª×¤×•×–×™× - â‚ª23
7. ×ª×¤×•×–×™× ×•×¡×œ×§ - â‚ª23

#### **×¢×™×§×¨×™×•×ª (Main Courses) - 2 meals**
1. ×—×–×” ×¢×•×£ ×¢× ××•×¨×– - â‚ª65
2. ×¡×œ××•×Ÿ ×¢× ××•×¨×– - â‚ª85

#### **×¡×œ×˜×™× (Salads) - 11 meals**
All salads include **base ingredients** + optional **×ª×•×¡×¤×•×ª (add-ons)**:

1. ×¡×œ×˜ ×§×™× ×•××” - â‚ª45
2. ×¡×œ×˜ ×¤×¨×™×§×” - â‚ª45
3. ×¡×œ×˜ ×¡×¤×’×˜×™ - â‚ª50
4. ×¡×œ×˜ ×—×œ×•××™ - â‚ª55
5. ×¡×œ×˜ ××¨×˜×™×©×•×§ - â‚ª50
6. ×¡×œ×˜ ×˜×•× ×” - â‚ª49
7. ×¡×œ×˜ ×‘×™×¦×” ×§×©×” - â‚ª49
8. ×¡×œ×˜ ××‘×•×§×“×• - â‚ª49
9. ×¡×œ×˜ ×¢×•×£ - â‚ª57
10. ×¡×œ×˜ ×¡×œ××•×Ÿ - â‚ª65

**Each salad supports optional add-ons:**
- + ××‘×•×§×“×• (â‚ª5)
- + ×˜×•× ×” (â‚ª5)
- + ×‘×™×¦×” ×§×©×” (â‚ª5)
- + ×—×–×” ×¢×•×£ ××¤×•×™ (â‚ª20)
- + ×©× ×™×¦×œ ××¤×•×™ (â‚ª20)
- + ×¡×œ××•×Ÿ ××¤×•×™ (â‚ª25)

---

## ğŸš€ Migration Steps

### **Step 1: Backup Current Data**
The script automatically backs up your existing data to `backend/data/backups/` before making changes.

### **Step 2: Run Migration**
```powershell
cd e:\Moringa\backend
python migrate_to_atlas.py
```

The script will:
1. âœ… Connect to MongoDB Atlas
2. ğŸ’¾ Backup existing categories, ingredients, and meals
3. âš ï¸  Ask for confirmation (type `YES` to proceed)
4. ğŸ—‘ï¸  Delete old data
5. ğŸ“¤ Upload corrected data
6. ğŸ” Verify the migration

### **Step 3: Verify on Frontend**
After migration:
1. Visit https://moringa-two.vercel.app/menu
2. Check that all categories appear
3. Verify meal prices are correct
4. Test adding ingredients to a salad
5. Test the complete checkout flow

---

## ğŸ”§ How the Ingredient System Works

### **In Backend (Already Supported!)**
Your `Meal` model already has:
```python
class MealIngredient(BaseModel):
    ingredient_id: str
    is_optional: bool = True      # Can customer choose?
    is_default: bool = False       # Included by default?
    extra_price: float = 0.0       # Extra charge
```

### **In Database**
Each meal now has ingredients array:
```json
{
  "name": {"he": "×¡×œ×˜ ×§×™× ×•××”"},
  "price": 45,
  "ingredients": [
    // Base ingredients (included in price)
    {"ingredient_id": "...", "is_default": true, "extra_price": 0},
    
    // Optional add-ons
    {"ingredient_id": "avocado-id", "is_optional": true, "extra_price": 5.0},
    {"ingredient_id": "chicken-id", "is_optional": true, "extra_price": 20.0}
  ]
}
```

### **In Frontend**
When customer selects a salad:
1. Show base ingredients (included)
2. Show "×ª×•×¡×¤×•×ª" section with optional add-ons
3. Calculate: `total = meal.price + sum(selected_addons.extra_price)`

---

## ğŸ“Š Database Structure

```
moringa_food_ordering/
â”œâ”€â”€ categories (6 documents)
â”‚   â”œâ”€â”€ ×›×¨×™×›×™×
â”‚   â”œâ”€â”€ ××¨×•×—×ª ×‘×•×§×¨
â”‚   â”œâ”€â”€ ×©×ª×™×” ×—××”
â”‚   â”œâ”€â”€ ××™×¥ ×˜×‘×¢×™
â”‚   â”œâ”€â”€ ×¢×™×§×¨×™×•×ª
â”‚   â””â”€â”€ ×¡×œ×˜×™×
â”‚
â”œâ”€â”€ ingredients (43 documents)
â”‚   â”œâ”€â”€ Premium (6): Avocado, Tuna, Egg, Chicken, Schnitzel, Salmon
â”‚   â””â”€â”€ Base (37): All vegetables, spreads, grains, etc.
â”‚
â””â”€â”€ meals (40 documents)
    â”œâ”€â”€ 8 Sandwiches (â‚ª30-40)
    â”œâ”€â”€ 5 Breakfast (â‚ª40-65)
    â”œâ”€â”€ 7 Hot Drinks (â‚ª10-13)
    â”œâ”€â”€ 7 Juices (â‚ª23)
    â”œâ”€â”€ 2 Main Courses (â‚ª65-85)
    â””â”€â”€ 11 Salads (â‚ª45-65) with customizable add-ons
```

---

## ğŸ¯ Testing Checklist

After migration, test:

- [ ] Menu loads on frontend
- [ ] All 6 categories appear
- [ ] Click each category to see meals
- [ ] Meal images display correctly
- [ ] Prices match the real menu
- [ ] Click on a salad
- [ ] See base ingredients listed
- [ ] See "×ª×•×¡×¤×•×ª" (add-ons) section
- [ ] Add an ingredient (e.g., Avocado â‚ª5)
- [ ] Price updates correctly
- [ ] Add to cart
- [ ] Cart shows meal + add-ons
- [ ] Checkout works
- [ ] Order appears in admin panel

---

## âš ï¸ Important Notes

1. **Backup is automatic** - Your old data is saved before deletion
2. **Type 'YES' carefully** - Migration is irreversible (unless you restore from backup)
3. **Frontend update** - Make sure your frontend handles the `ingredients` array properly
4. **Add-on display** - Salads should show optional add-ons with prices
5. **Price calculation** - Total = base price + selected add-ons

---

## ğŸ”„ Rollback (If Needed)

If something goes wrong:
```python
# Your backups are in: backend/data/backups/
# Format: categories_backup_YYYYMMDD_HHMMSS.json

# To restore, modify migrate_to_atlas.py to read from backup files
# instead of corrected_*.json files
```

---

## ğŸ“ Need Help?

If you encounter issues:
1. Check the backup files in `backend/data/backups/`
2. Verify MongoDB Atlas connection
3. Test API endpoint: `https://moringa-production-93eb.up.railway.app/api/v1/meals`
4. Check frontend console for errors

---

## âœ… Success Criteria

Migration is successful when:
- âœ… All 40 meals appear on the menu
- âœ… Prices match your restaurant's actual menu
- âœ… Salads show customizable add-ons (×ª×•×¡×¤×•×ª)
- âœ… Customers can add Avocado (â‚ª5), Chicken (â‚ª20), etc.
- âœ… Total price calculates correctly
- âœ… Orders save with selected ingredients
- âœ… Admin panel shows ingredient selections

**Ready to migrate? Run the script!** ğŸš€
